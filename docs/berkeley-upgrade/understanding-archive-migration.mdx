---
title: Understanding archive migration
sidebar_label: Understanding archive migration
hide_title: true
description: Overview of the migration tools and requirements to successfully migrate Devnet/Mainnet archive database.
keywords:
  - Berkeley
  - upgrade
  - archive migration
  - planning 
  - prerequisites
  - mina archive node
  - archive node
---

# Planning the Archive Migration

Before you start the migration of your archive node database into the Berkeley version of the Mina network, read this document in entirety.

## Overview

Archive node migration is a crucial part of Berkeley upgrade. We need to convert devnet/mainnet database to berkeley one in order to preserves historical data and assure archive node chain continuity.
For this purpose o1Labs and mina-foundation teams prepared two packages:

### Archive Node Berkeley migration package

This package contains applications needed to migrated existing devnet/mainnet database into new bekeley schema.
Briefly it contains 3 apps and 1 usability script:

1. **berkeley-migration**

  The berkeley-migration application migrates as much data as possible from the Devnet/Mainnet database and downloads precomputed blocks to get the window density data. 
  
  This application runs against the Devnet/Mainnet and the new database.

2. **replayer in migration mode**

  The existing replayer application is enhanced with a new mode: migration mode. Replayer in migration mode analyzes the transactions in the partially migrated database (resulting from running berkeley-migration app) and populates the `accounts_accessed` and `accounts_created` tables. This application also does the checks performed by the standard replayer, but does not check ledger hashes because the Berkeley ledger has greater depth, which results in different hashes. This application runs only against the new archive database.

4. **berkeley-migration-verifier**

  The berkeley-migration-verifier is verification software which helps to determine if migration (even incomplete) was successful by utilizing SQL validations on migrated database

5. ** end-to-end migration script**

  Migration script is a shell script which wraps all phases and stages of migration into single script. It is provided purely for node operators usability and is equivalent of running berkely-migration, replayer in migration mode and berkeley-migration-verifier apps in correct order

#### Incrementality

The berkeley-migration and replayer applications are able to work incrementally so that part of the Devnet/Mainnet database can be migrated and, as new blocks are added to the Devnet/Mainnet, the new data in the database can be migrated.

To obtain that incrementality, the berkeley-migration application can look at the migrated database and determine the most recent migrated block. It can continue migrating starting at the next block in the Devnet/Mainnet data. The replayer app in migration mode can use the checkpoint mechanism already in place for the replayer. A checkpoint file indicates the global slot since genesis for starting the replay and the ledger to use for that replay. The application writes new checkpoint files as it proceeds.

To take advantage of the incrementality, you can run a cron job that migrates a day's worth of data at a time (or some other interval). With the cron job in place, at the time of the actual Berkeley upgrade, only a small amount of data will need to be migrated.
